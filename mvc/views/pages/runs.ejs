<!doctype html>
<html lang="en" xmlns:width="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <!--    <link rel="icon" href="../../static/imgs/logo.png">-->
    <link rel="icon" href="../../../static/imgs/simpleLogoLightShadow.png">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css"
          integrity="sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp"
          crossorigin="anonymous">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css"
          integrity="sha384-WskhaSGFgHYWDcbwN70/dfYBj47jz9qbsMId/iRN3ewGhXQFZCSftd1LZCfmhktB"
          crossorigin="anonymous">
    <link rel="stylesheet" href="../../../static/css/colors.css">
    <script src="../lib/gridHelpers.js"></script>

<% if(currentRun) { %>
        <title>VRS list of checks - <%= currentRun.name %> </title>
    <% }else{ %>
        <title>VRS list of checks - all runs</title>
    <% } %>

</head>
<body>

<div name="main" class="main container-fluid pl-3 pr-3 ml-0 mh-100">
    <div name="page-head" class="row bg-sidebar sticky-top">
        <div name="logo-and-link"  class="col-5 w-25 pl-0 pb-2 bg-sidebar text-light" id="logo-and-label-container">
            <%- include('components/logo_and_link', {drop: true})%>
        </div>

        <div name="run-menu-toolbar" class="col">
            <div class="row all-header light-purple sticky-top1">
                <div class="tests-toolbar sticky-top1 col text-light p-1 pt-3 bg-sidebar align-self-end">
                    <div class="sticky-top1 row d-flex flex-row-reverse pr-2">

                        <div class="col-auto pl-1">
                            <a name="more-tests" type="button" class="btn btn-secondary bg-sidebar border-0"
                               title="more">
                                <i class="fas fa-ellipsis-v fa-1x"></i>
                            </a>
                        </div>
                        <div class="col-auto pl-1 pr-1">
                            <a name="remove-tests" type="button" class="btn btn-secondary bg-sidebar border-0"
                               onclick="removeTests()"
                               title="remove checked tests">
                                <i class="fas fa-trash fa-1x"></i>
                            </a>
                        </div>
                        <div class="col-auto pl-1 pr-1">
                            <a name="accept-checks" type="button" class="btn btn-secondary bg-sidebar border-0"
                               onclick="acceptSelectedChecks()"
                               title="accept selected checks">
                                <i class="far fa-check-circle fa-1x"></i>
                            </a>
                        </div>
                        <div class="col-auto pl-1 pr-1">
                            <a name="reload-tests" type="button" class="btn btn-secondary bg-sidebar border-0"
                               onclick="location.reload()"
                               title="reload page">
                                <i class="fas fa-sync-alt fa-1x"></i>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!--    DATA GRID START    -->
    <div class="all-table row mh-100">
        <!--   SIDEBAR    -->
        <div name="sidebar" class="sidebar col-5 pr-0 mr-0 ml-1 pl-1 bg-light border-top border-right border-bottom border-silver float-left ml-0 mr-0"
             style="width: 100px">
            <%- include('components/sidebar_items_toolbar', {itemName: 'run-item'}) %>

            <!--   SUITES LIST-->
            <div class="runs-list ml-0 row pl-2 pt-1 pr-0 bg-light text-secondary mr-0">
                <% let items = runs %>
                <%- include('components/sidebar_items_runs', {items: items})%>
            </div>
            <!--  SUITES LIST END-->
        </div>
        <!--   TESTS TABLE-->
        <div name class="table-rows p-0 content col float-right ">
            <%- include('components/subheader_title_rows', {currentItem: currentRun}) %>
            <%- include('components/tests_table_headers_runs', {})%>

            <div name="tests-row" class="checks pl-0 m-0 row">
                <%- include('components/tests_table_rows_runs', {checksByTestGroupedByIdent: checksByTestGroupedByIdent})%>
            </div>
        </div>
    </div>
</div>

<!--NOTIFY BOX-->
<div id="notify" role="alert" aria-live="assertive" aria-atomic="true"
     class="fixed-bottom-right bg-light m-1 border rounded toast fade show"
     data-autohide="false"
     style="display: none"
>
    <div class="toast-header border-bottom">
        <svg class="bd-placeholder-img rounded mr-2" width="20" height="20" xmlns="http://www.w3.org/2000/svg"
             preserveAspectRatio="xMidYMid slice" focusable="false" role="img">
            <rect id="notify-rect" width="100%" height="100%" fill="#2ECC40"></rect>
        </svg>
        <strong id="notify-header" class="mr-auto">Success</strong>
        <!--        <small>11 mins ago</small>-->
        <button type="button" class="ml-2 mb-1 close" data-dismiss="toast" aria-label="Close"
                onclick="$('#notify').hide()">
            <span aria-hidden="true">Ã—</span>
        </button>
    </div>
    <div id="notify-message" class="toast-body">
        Operation was successful finished
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
        integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
        crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"
        integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49"
        crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js"
        integrity="sha384-smHYKdLADwkXOn1EmN1qk/HfnUcbVRZyYmZ4qpPea6sjB/pTJ0euyQp0Mk8ck+5T"
        crossorigin="anonymous"></script>
<script src="http://cdnjs.cloudflare.com/ajax/libs/fabric.js/3.6.1/fabric.min.js"></script>
<script src="../lib/baselineView.js"></script>
<script>
    var baselines = {}
    const urlParams = new URLSearchParams(window.location.search);
    const unfoldTestId = urlParams.get('unfoldTestId');
    if (unfoldTestId)
        unfoldCheck(unfoldTestId)

    function unfoldCheck(id) {
        jQuery(`#testchecks_${id}`)[0].scrollIntoView();
        jQuery(`#testchecks_${id}`).collapse('show');
        drawTestChecksPreviews(unfoldTestId);
    }

    function drawOverlay(expectedId, actualId, diff) {
        document.getElementById('overlay').style.display = 'block';
    }

    function drawTestChecksPreviews(testId) {
        var checksDivs = Array.prototype.slice.call(document.getElementById(`testchecks_${testId}`).children);
        let checksIds = []
        checksDivs.forEach(el => checksIds.push(el.id.replace('check_', '')))

        let baselineIds = []
        checksDivs.forEach(el => baselineIds.push(el.getAttribute('baselineId')))

        let diffsIds = []
        checksDivs.forEach(el => diffsIds.push(el.getAttribute('diffId')))

        let statuses = []
        checksDivs.forEach(el => statuses.push(el.getAttribute('checkStatus')))
        console.log(statuses)

        checksIds.forEach(function (id, index) {
            let baseline = {};
            fabric.Object.prototype.objectCaching = false;
            const snapshotId = ((statuses[index] === 'new') || (statuses[index] === 'passed') || (statuses[index] === 'blinking')) ? baselineIds[index] : diffsIds[index]
            // const snapshotId = diffsIds[index]
            fabric.Image.fromURL(`/snapshoots/${snapshotId}.png`, function (oImg) {
                baseline = new BaselineView('canvas_snapshoot_' + id,
                    oImg,
                    {
                        weight: document.getElementById('canvas_snapshoot_' + id).offsetWidth,
                        backimageId: baselineIds[index]
                    }
                );
                baseline.getSnapshotIgnoreRegionsDataAndDrawRegions(baselineIds[index]);
                baseline.canvas.hoverCursor = "pointer";
                baselines[id] = baseline;
            })
        })
    }

    $(function () {
        $('[data-toggle="tooltip"]')
            .tooltip({
                animation: true,
                delay: {
                    show: 0,
                    hide: 100
                }
            });
    });</script>
<script>
    window.addEventListener('resize', setSuiteMenuWidth);
</script>
</body>
</html>
